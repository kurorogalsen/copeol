<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Copeol - Home</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
</head>

<body>
    <header class="container-fluid p-3 d-flex align-items-center justify-content-between">
        <a href="{% url 'home' %}">
            <h1 id="login-title">Copeol</h1>
        </a>
        <div id="user-profile" class="d-flex flex-column align-items-end">
            <button class="btn btn-primary rounded-circle p-0 bi bi-person-circle" data-toggle="collapse"
                data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"
                style="width: 30px;height: 30px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                    <path fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                </svg>
            </button>
            <div class="collapse" id="collapseExample">
                <div class="card card-body">
                    <div style="text-transform: capitalize;">
                        {{user.first_name}} (
                        {% if request.session.role == -1 %} Super administrateur{% endif %}
                        {% if request.session.role == 1 %} Chef des achats {% endif %}
                        {% if request.session.role == 2 %} Laborantin {% endif %}
                        {% if request.session.role == 3 %} Receptionniste {% endif %} )
                    </div>
                    <hr />
                    <div>
                        {{user.email}}
                    </div>
                    <hr />
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#profile-modal">
                        Modifier mon profil
                    </button>
                    <hr />
                    <div>
                        <a href="{% url 'logout' %}" title="Déconnexion">Déconnexion</a>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <div class="modal fade" id="profile-modal" tabindex="-1" aria-labelledby="profile-modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profile-modalLabel">Modifier mes infomations personnelles </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" enctype="multipart/form-data" action="/home/editprofile/{{user.id}}">
                        <h3 class="my-3">Modifier informations</h3>
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="{{user.username}}">Username</label>
                            <input type="text" class="form-control" name="username" id="{{user.username}}"
                                value="{{user.username}}">
                        </div>
                        <div class="form-group">
                            <label for="{{user.first_name}}">Prénom</label>
                            <input type="text" class="form-control" name="first_name" id="{{user.first_name}}"
                                value="{{user.first_name}}">
                        </div>
                        <div class="form-group">
                            <label for="{{user.last_name}}">Nom</label>
                            <input type="text" class="form-control" name="last_name" id="{{user.last_name}}"
                                value="{{user.last_name}}">
                        </div>
                        <div class="form-group">
                            <label for="{{user.email}}">Email</label>
                            <input type="email" class="form-control" name="email" id="{{user.email}}"
                                value="{{user.email}}">
                        </div>
                        <div class="form-group">
                            <label for="{{user.password1}}">Password</label>
                            <input type="password" class="form-control" name="password1" id="{{user.password1}}" required>
                        </div>
                        <div class="form-group">
                            <label for="{{user.password2}}">Confirm password</label>
                            <input type="password" class="form-control" name="password2" id="{{user.password2}}" required>
                        </div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                        <button class="btn btn-success my-4" type="submit">Enregistrer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <main class="container-fluid px-0 m-0 row">
        <aside class="bg-dark d-flex flex-column align-items-center">
            {% if request.session.role == -1 %}
            <a class="menu-icon p-3" href="{% url 'users' %}" title="Utilisateurs">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray" class="bi bi-people-fill"
                    viewBox="0 0 16 16">
                    <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                    <path fill-rule="evenodd"
                        d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z" />
                    <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                </svg>
            </a>
            {% endif %}
            {% if request.session.role == -1 or request.session.role == 1 %}
            <a class="menu-icon p-3" href="{% url 'commandes' %}" title="Commandes">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray" class="bi bi-bag-fill"
                    viewBox="0 0 16 16">
                    <path
                        d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5z" />
                </svg>
            </a>
            {% endif %}
            {% if request.session.role == -1 or request.session.role == 3 %}

            <a class="menu-icon p-3" href="{% url 'receptions' %}" title="Fiches de réception">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray"
                    class="bi bi-file-arrow-down-fill" viewBox="0 0 16 16">
                    <path
                        d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z" />
                </svg>
            </a>
            {% endif %}
            {% if request.session.role == -1 or request.session.role == 2 %}

            <a class="menu-icon p-3" href="{% url 'analyses' %}" title="Fiches d'analyse">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray"
                    class="bi bi-clipboard-data-fill" viewBox="0 0 16 16">
                    <path
                        d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z" />
                    <path
                        d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1ZM10 8a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V8Zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1Zm4-3a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1Z" />
                </svg>
            </a>
            {% endif %}
            {% if request.session.role == -1 or request.session.role == 1 %}
            <a class="menu-icon p-3" href="{% url 'factures' %}" title="Factures">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray" class="bi bi-folder-fill"
                    viewBox="0 0 16 16">
                    <path
                        d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.825a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3zm-8.322.12C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139z" />
                </svg>
            </a>
            {% endif %}

            <a class="menu-icon p-3" href="{% url 'logout' %}" title="Déconnexion">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="gray" class="bi bi-box-arrow-right"
                    viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
                    <path fill-rule="evenodd"
                        d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
                </svg>
            </a>

        </aside>
        <section class="p-2">

            {% if messages %}
            <ul>
                {% for message in messages %}
                <li>{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}

            <!-- Users -->
            {% if users_form %}
            <div class="w-100 p-0 m-0">
                <button class="btn btn-success my-4" data-toggle="modal" data-target="#user-form">
                    Ajouter un utilisateur
                </button>
                <div class="modal fade" id="user-form" tabindex="-1" role="dialog" aria-labelledby="User formulaire"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body">
                                <form method="post" enctype="multipart/form-data">
                                    <h3 class="my-3">Nouvel utilisateur</h3>
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="{{users_form.username.id_for_label}}">Username</label>
                                        <input type="text" class="form-control" name="{{users_form.username.name}}"
                                            id="{{users_form.username.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{users_form.first_name.id_for_label}}">Prénom</label>
                                        <input type="text" class="form-control" name="{{users_form.first_name.name}}"
                                            id="{{users_form.first_name.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{users_form.last_name.id_for_label}}">Nom</label>
                                        <input type="text" class="form-control" name="{{users_form.last_name.name}}"
                                            id="{{users_form.last_name.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{users_form.email.id_for_label}}">Email</label>
                                        <input type="email" class="form-control" name="{{users_form.email.name}}"
                                            id="{{users_form.email.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{users_form.password1.id_for_label}}">Password</label>
                                        <input type="password" class="form-control" name="{{users_form.password1.name}}"
                                            id="{{users_form.password1.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{users_form.password2.id_for_label}}">Confirm password</label>
                                        <input type="password" class="form-control" name="{{users_form.password2.name}}"
                                            id="{{users_form.password2.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="#id_group_">Rôle</label>
                                        <select id="id_group" name="group" class="form-control">
                                            {% for m in users_form.group %}
                                            {{m}}
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                    <button class="btn btn-success my-4" type="submit">Créer</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-100 card">
                    <div class="w-100 card-header">
                        <h2>Utilisateurs</h2>
                    </div>

                    <div class="w-100 card-body">
                        {% if messages %}
                        <ul>
                            {% for message in messages %}
                            <li>{{ message }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                        <table class="w-100 table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Username</th>
                                    <th scope="col">Prénom</th>
                                    <th scope="col">Nom</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Rôle</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in users %}
                                <tr>
                                    <th scope="row">{{m.id}}</th>
                                    <td>{{m.username}}</td>
                                    <td>{{m.first_name}}</td>
                                    <td>{{m.last_name}}</td>
                                    <td>{{m.email}}</td>
                                    <td>
                                        {% for group in m.groups.all %}
                                        {{ group.name }}
                                        {% endfor %}
                                    </td>
                                    <td>
                                        <span title="Voir le user" class="m-2 pointer" role="button" data-toggle="modal"
                                            data-target="#user{{m.id}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                fill="#25a6d5" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                                <path
                                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                            </svg>
                                        </span>
                                        <a href="delete/{{ m.id }}" title="Supprimer la commande" class="m-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red"
                                                class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>


                                <div class="modal fade" id="user{{m.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="User formulaire" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <form method="post" enctype="multipart/form-data"
                                                    action="update/{{m.id}}">
                                                    <h3 class="my-3">Mettre à jour le user</h3>
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="user{{m.id}}-username">
                                                            Username</label>
                                                        <input type="text" class="form-control" name="username"
                                                            id="user{{m.id}}-username" value="{{m.username}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="user{{m.id}}-first_name">
                                                            Prénom</label>
                                                        <input type="text" class="form-control" name="first_name"
                                                            id="user{{m.id}}-first_name" value="{{m.first_name}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="user{{m.id}}-last_name">
                                                            Nom</label>
                                                        <input type="text" class="form-control" name="last_name"
                                                            id="user{{m.id}}-last_name" value="{{m.last_name}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="user{{m.id}}-email">
                                                            Email</label>
                                                        <input type="text" class="form-control" name="email"
                                                            id="user{{m.id}}-email" value="{{m.email}}">
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="user{{m.id}}-group">Rôle</label>
                                                        <select id="user{{m.id}}-group" name="group"
                                                            class="form-control">
                                                            {% for n in groups %}
                                                            <option value="{{n.id}}">
                                                                {{n.name}}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Fermer</button>
                                                    <button class="btn btn-warning my-4" type="submit">Modifier</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p>Pas de user.</p>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {% endif %}
            <!-- Commandes -->
            {% if commande_form %}
            <div class="w-100 p-0 m-0">
                <button class="btn btn-success my-4" data-toggle="modal" data-target="#commande-form">
                    Ajouter une commande
                </button>
                <div class="modal fade" id="commande-form" tabindex="-1" role="dialog"
                    aria-labelledby="Commande formulaire" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body">
                                <form method="post" enctype="multipart/form-data">
                                    <h3 class="my-3">Nouvelle commande</h3>
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="{{commande_form.lv_commande.id_for_label}}">LV commande</label>
                                        <input type="text" maxlength="6" class="form-control"
                                            name="{{commande_form.lv_commande.name}}"
                                            id="{{commande_form.lv_commande.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label
                                            for="{{commande_form.provenance_commande.id_for_label}}">Provenance_commande</label>
                                        <input type="text" class="form-control"
                                            name="{{commande_form.provenance_commande.name}}"
                                            id="{{commande_form.provenance_commande.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{commande_form.date_commande.id_for_label}}">Date</label>
                                        <input type="date" name="{{ commande_form.date_commande.name }}"
                                            class="form-control" id="{{ commande_form.date_commande.id_for_label }}">
                                    </div>

                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                    <button class="btn btn-success my-4" type="submit">Créer</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-100 card">
                    <div class="w-100 card-header">
                        <h2>Commandes</h2>
                    </div>
                    <div class="w-100 card-body">
                        <table class="w-100 table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">LV</th>
                                    <th scope="col">Provenance</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in commande %}
                                <tr>
                                    <th scope="row">{{m.id}}</th>
                                    <td>{{m.lv_commande}}</td>
                                    <td>{{m.provenance_commande}}</td>
                                    <td>{{m.date_commande}}</td>
                                    <td>
                                        <span title="Voir la commande" class="m-2 pointer" role="button"
                                            data-toggle="modal" data-target="#commande{{m.id}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                fill="#25a6d5" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                                <path
                                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                            </svg>
                                        </span>
                                        <a href="delete/{{ m.id }}" title="Supprimer la commande" class="m-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red"
                                                class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>

                                <div class="modal fade" id="commande{{m.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="Commande formulaire" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <form method="post" enctype="multipart/form-data"
                                                    action="update/{{m.id}}">
                                                    <h3 class="my-3">Mettre à jour la commande</h3>
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="commande{{m.id}}-lv">LV
                                                            commande</label>
                                                        <input type="text" maxlength="6" class="form-control"
                                                            name="lv_commande" id="commande{{m.id}}-lv"
                                                            value="{{m.lv_commande}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label
                                                            for="commande{{m.id}}-provenance">Provenance_commande</label>
                                                        <input type="text" class="form-control"
                                                            name="provenance_commande" id="commande{{m.id}}-provenance"
                                                            value="{{m.provenance_commande}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="commande{{m.id}}-date">Date</label>
                                                        <input type="date" name="date_commande" class="form-control"
                                                            id="commande{{m.id}}-date"
                                                            value='{{m.date_commande|date:"Y-m-d"}}'>
                                                    </div>

                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Fermer</button>
                                                    <button class="btn btn-warning my-4" type="submit">Modifier</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p>Pas de commandes.</p>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Fiches de réception -->
            {% if reception_form %}
            <div class="w-100 p-0 m-0">
                <button class="btn btn-success my-4" data-toggle="modal" data-target="#reception-form">
                    Ajouter une fiche de réception
                </button>
                <div class="modal fade" id="reception-form" tabindex="-1" role="dialog"
                    aria-labelledby="Fiche de reception formulaire" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body">
                                <form method="post" enctype="multipart/form-data">
                                    <h3 class="my-3">Nouvelle fiche de reception</h3>
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="{{reception_form.variete.id_for_label}}">LV livraison</label>
                                        {{reception_form.lv_livraison}}
                                        <!-- <input type="number" class="form-control" name="{{reception_form.variete.name}}"
                                        id="{{reception_form.variete.id_for_label}}"> -->
                                    </div>
                                    <div class="form-group">
                                        <label for="{{reception_form.poids_brut.id_for_label}}">Poids Brut</label>
                                        <input type="number" class="form-control"
                                            name="{{reception_form.poids_brut.name}}"
                                            id="{{reception_form.poids_brut.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{reception_form.provenance_livraison.id_for_label}}">
                                            Provenance Livraison
                                        </label>
                                        <input type="text" class="form-control"
                                            name="{{reception_form.provenance_livraison.name}}"
                                            id="{{reception_form.provenance_livraison.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{reception_form.date_livraison.id_for_label}}">Date
                                            Livraison</label>
                                        <input type="date" name="{{ reception_form.date_livraison.name }}"
                                            class="form-control" id="{{ reception_form.date_livraison.id_for_label }}">
                                    </div>

                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                    <button class="btn btn-success my-4" type="submit">Créer</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-100 card">
                    <div class="w-100 card-header">
                        <h2>Liste des fiches de reception</h2>
                    </div>
                    <div class="w-100 card-body">
                        <table class="w-100 table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">LV livraison</th>
                                    <th scope="col">Poids Brut (Kg)</th>
                                    <th scope="col">Provenance Livraison (%)</th>
                                    <th scope="col">Date Livraison</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in reception %}
                                <tr>
                                    <th scope="row">{{m.id}}</th>
                                    <td>{{m.lv_livraison}}</td>
                                    <td>{{m.poids_brut}}</td>
                                    <td>{{m.provenance_livraison}}</td>
                                    <td>{{m.date_livraison}}</td>
                                    <td>
                                        <span title="Voir la fiche" class="m-2 pointer" role="button"
                                            data-toggle="modal" data-target="#reception{{m.id}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                fill="#25a6d5" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                                <path
                                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                            </svg>
                                        </span>
                                        <a href="delete/{{ m.id }}" title="Supprimer la fiche" class="m-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red"
                                                class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>

                                <div class="modal fade" id="reception{{m.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="Fiche de reception formulaire" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <form method="post" enctype="multipart/form-data"
                                                    action="update/{{m.id}}">
                                                    <h3 class="my-3">Mettre à jour la fiche</h3>
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="#reception{{m.id}}-lv_livraison">LV livraison
                                                        </label>
                                                        {{reception_form.lv_livraison}}
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="reception{{m.id}}-poids_brut">
                                                            Poids Brut (kg)</label>
                                                        <input type="number" class="form-control" name="poids_brut"
                                                            id="reception{{m.id}}-poids_brut" value="{{m.poids_brut}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="reception{{m.id}}-provenance-livraison">Provenance
                                                            livraison
                                                        </label>
                                                        <input type="text" class="form-control"
                                                            name="provenance_livraison"
                                                            id="reception{{m.id}}-provenance-livraison"
                                                            value="{{m.provenance_livraison}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="reception{{m.id}}-date_livraison">Date
                                                            livraison</label>
                                                        <input type="Date" min="0" name="date_livraison"
                                                            class="form-control" id="reception{{m.id}}-date_livraison"
                                                            value='{{m.date_livraison | date:"Y-m-d"}}'>
                                                    </div>

                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Fermer</button>
                                                    <button class="btn btn-warning my-4" type="submit">Modifier</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p>Pas de fiche pour l'instant.</p>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Fiches d'analyse -->
            {% if analyse_form%}
            <div class="w-100 p-0 m-0">
                <button class="btn btn-success my-4" data-toggle="modal" data-target="#analyse-form">
                    Ajouter une fiche d'analyse
                </button>
                <div class="modal fade" id="analyse-form" tabindex="-1" role="dialog"
                    aria-labelledby="Fiche d'analyse formulaire" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body">
                                <form method="post" enctype="multipart/form-data">
                                    <h3 class="my-3">Nouvelle fiche d'analyse</h3>
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="{{analyse_form.variete.id_for_label}}">Varietés</label>
                                        {{analyse_form.variete}}
                                        <!-- <input type="number" class="form-control" name="{{analyse_form.variete.name}}"
                                        id="{{analyse_form.variete.id_for_label}}"> -->
                                    </div>
                                    <div class="form-group">
                                        <label for="{{analyse_form.fiche_reception.id_for_label}}">Fiche de
                                            reception</label>
                                        {{analyse_form.fiche_reception}}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{analyse_form.humidite.id_for_label}}">Taux d'humidité (%)</label>
                                        <input min="0" max="100" type="number" class="form-control"
                                            name="{{analyse_form.humidite.name}}"
                                            id="{{analyse_form.humidite.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{analyse_form.impuretes.id_for_label}}">Taux d'impuretés
                                            (%)</label>
                                        <input min="0" max="100" type="number" class="form-control"
                                            name="{{analyse_form.impuretes.name}}"
                                            id="{{analyse_form.impuretes.id_for_label}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="{{analyse_form.taux_graines_defectueuses.id_for_label}}">Taux de
                                            graines défectueuses (%)</label>
                                        <input type="number" name="{{ analyse_form.taux_graines_defectueuses.name }}"
                                            class="form-control"
                                            id="{{ analyse_form.taux_graines_defectueuses.id_for_label }}">
                                    </div>

                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                    <button class="btn btn-success my-4" type="submit">Créer</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-100 card">
                    <div class="w-100 card-header">
                        <h2>Liste des fiches d'analyse</h2>
                    </div>
                    <div class="w-100 card-body">
                        <table class="w-100 table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Fiche de reception</th>
                                    <th scope="col">Varietés</th>
                                    <th scope="col">Humidité (%)</th>
                                    <th scope="col">Impuretés (%)</th>
                                    <th scope="col">Graines Defectueuses (%)</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in analyse %}
                                <tr>
                                    <th scope="row">{{m.id}}</th>
                                    <td>{{m.fiche_reception}}</td>
                                    <td>{{m.variete}}</td>
                                    <td>{{m.humidite}}</td>
                                    <td>{{m.impuretes}}</td>
                                    <td>{{m.taux_graines_defectueuses}}</td>
                                    <td>
                                        <span title="Voir la fiche" class="m-2 pointer" role="button"
                                            data-toggle="modal" data-target="#analyse{{m.id}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                fill="#25a6d5" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                                <path
                                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                            </svg>
                                        </span>
                                        <a href="delete/{{ m.id }}" title="Supprimer la fiche" class="m-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red"
                                                class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>

                                <div class="modal fade" id="analyse{{m.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="Fiche d'analyse formulaire" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <form method="post" enctype="multipart/form-data"
                                                    action="update/{{m.id}}">
                                                    <h3 class="my-3">Mettre à jour la fiche</h3>
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="#analyse{{m.id}}-fiche_reception">Fiche de reception
                                                        </label>
                                                        {{analyse_form.fiche_reception}}
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="#analyse{{m.id}}-variete">Varietés
                                                        </label>
                                                        {{analyse_form.variete}}
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="analyse{{m.id}}-humidite">
                                                            Taux d'humidité (%)</label>
                                                        <input type="text" class="form-control" name="humidite"
                                                            id="analyse{{m.id}}-humidite" value="{{m.humidite}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="analyse{{m.id}}-impuretes">Taux d'impureté
                                                            (%)</label>
                                                        <input type="text" class="form-control" name="impuretes"
                                                            id="analyse{{m.id}}-impuretes" value="{{m.impuretes}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="analyse{{m.id}}-graines">Taux de graines
                                                            defectueuses (%)</label>
                                                        <input type="number" min="0" name="taux_graines_defectueuses"
                                                            class="form-control" id="analyse{{m.id}}-graines"
                                                            value='{{m.taux_graines_defectueuses}}'>
                                                    </div>

                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Fermer</button>
                                                    <button class="btn btn-warning my-4" type="submit">Modifier</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p>Pas de fiche pour l'instant.</p>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Factures -->
            {% if facture_form%}
            <div class="w-100 p-0 m-0">
                <div class="w-100 card">
                    <div class="w-100 card-header">
                        <h2>Liste des factures</h2>
                    </div>
                    <div class="w-100 card-body">
                        <table class="w-100 table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Fiche d'analyse</th>
                                    <th scope="col">Provenance</th>
                                    <th scope="col">PNC (Kg)</th>
                                    <th scope="col">Prix unitaire (FCFA)</th>
                                    <th scope="col">Frais Livraison (FCFA)</th>
                                    <th scope="col">Frais dechargement (FCFA)</th>
                                    <th scope="col">Montant total (FCFA)</th>
                                    <th scope="col">Date facture</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for m in facture %}
                                <tr>
                                    <th scope="row">{{m.id}}</th>
                                    <td>{{m.fiche_analyse}}</td>
                                    <td>{{m.provenance}}</td>
                                    <td>{{m.pnc}}</td>
                                    <td>{{m.prix_unitaire}}</td>
                                    <td>{{m.frais_livraison}}</td>
                                    <td>{{m.frais_dechargement}}</td>
                                    <td>{{m.montant_total}}</td>
                                    <td>{{m.date_facture}}</td>
                                    <td>
                                        <span title="Voir la fiche" class="m-2 pointer" role="button"
                                            data-toggle="modal" data-target="#facture{{m.id}}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25"
                                                fill="#25a6d5" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                                <path
                                                    d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                            </svg>
                                        </span>
                                        <a href="delete/{{ m.id }}" title="Supprimer la fiche" class="m-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="red"
                                                class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                <path
                                                    d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                                            </svg>
                                        </a>
                                    </td>
                                </tr>

                                <div class="modal fade" id="facture{{m.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="Facture formulaire" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <form method="post" enctype="multipart/form-data"
                                                    action="update/{{m.id}}">
                                                    <h3 class="my-3">Mettre à jour la facture</h3>
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="facture{{m.id}}-prix_unitaire">
                                                            prix_unitaire (FCFA)</label>
                                                        <input type="number" class="form-control" name="prix_unitaire"
                                                            id="facture{{m.id}}-prix_unitaire"
                                                            value="{{m.prix_unitaire}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="facture{{m.id}}-frais_livraison">
                                                            Frais livraison (FCFA)</label>
                                                        <input type="number" class="form-control" name="frais_livraison"
                                                            id="facture{{m.id}}-frais_livraison"
                                                            value="{{m.frais_livraison}}">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="facture{{m.id}}-frais_dechargement">
                                                            Frais dechargement (FCFA)</label>
                                                        <input type="number" class="form-control"
                                                            name="frais_dechargement"
                                                            id="facture{{m.id}}-frais_dechargement"
                                                            value="{{m.frais_dechargement}}">
                                                    </div>

                                                    <input hidden type="number" class="form-control" name="pnc"
                                                        id="facture{{m.id}}-pnc" value="{{m.pnc}}">

                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Fermer</button>
                                                    <button class="btn btn-warning my-4"
                                                        type="submit">Enregistrer</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p>Pas de fiche pour l'instant.</p>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
        </section>
    </main>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</body>

</html>